This code is taken from the FreeRTOS book examples
